<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>競合分析 | THE DOCTOR'S</title>
    <link rel="stylesheet" href="/static/admin/competitive/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <a href="/" class="logo">THE DOCTOR'S</a>
        </div>
    </header>

    <div class="main-container">
        <main class="form-area">
            <form id="competitive-analysis-form">
                <!-- Step 1: 自院情報入力 -->
                <div class="form-step active" data-step="1">
                    <div class="step-header">
                        <span class="icon"><img src="/images/icons/hawk.webp" alt="hawk" style="width:100%;height:100%;object-fit:cover;border-radius:50%;"></span>
                        <div>
                            <div class="progress-bar">
                                <span>1/3問目</span>
                                <div class="progress" style="width: 33%;"></div>
                            </div>
                            <h4 class="question-text">あなたのクリニック情報を入力してください。</h4>
                        </div>
                    </div>

                    <!-- CSVアップロード機能 -->
                    <div class="csv-upload-section" style="margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                            <div>
                                <h5 style="margin: 0 0 5px 0; color: #333;">CSVファイルから読み込む</h5>
                                <p style="margin: 0; font-size: 0.9em; color: #666;">ExcelテンプレートをCSV形式で保存してアップロードしてください</p>
                            </div>
                            <a href="/クリニック情報.xlsx" download="クリニック情報.xlsx" 
                               style="padding: 8px 16px; background-color: #fff; border: 1px solid #2563eb; color: #2563eb; text-decoration: none; border-radius: 4px; font-size: 0.9em;">
                                📥 Excelテンプレートをダウンロード
                            </a>
                        </div>
                        
                        <div class="csv-upload-area" style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 20px; text-align: center; background-color: #fff;">
                            <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
                            <label for="csv-file-input" style="cursor: pointer;">
                                <div style="margin-bottom: 10px;">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </div>
                                <p style="margin: 0; color: #64748b;">クリックしてCSVファイルを選択<br>
                                <span style="font-size: 0.85em;">またはファイルをドラッグ＆ドロップ</span></p>
                            </label>
                            <div id="csv-upload-status" style="margin-top: 10px; display: none;">
                                <span style="color: #10b981; font-size: 0.9em;">✅ ファイルを読み込みました</span>
                            </div>
                        </div>
                    </div>

                    <div class="clinic-info-form">
                        <div class="form-group">
                            <label for="clinic-name">クリニック名 <span class="required">*</span></label>
                            <input type="text" id="clinic-name" name="clinicName" placeholder="例：田中内科クリニック" required>
                        </div>

                        <div class="form-group">
                            <label for="postal-code">郵便番号</label>
                            <div class="postal-code-input">
                                <input type="text" id="postal-code" name="postalCode" placeholder="例：123-4567" maxlength="8">
                                <button type="button" class="postal-search-btn">住所検索</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="address">住所 <span class="required">*</span></label>
                            <input type="text" id="address" name="address" placeholder="例：東京都渋谷区道玄坂1-2-3" required>
                        </div>

                        <div class="form-group">
                            <label>診療科 <span class="required">*</span></label>
                            <div class="department-options">
                                <!-- Admin - 全診療科 -->
                                <label><input type="radio" name="department" value="ophthalmology"><div class="department-icon" style="background-image: url('/images/departments/眼科.png');"></div> 眼科</label>
                                <label><input type="radio" name="department" value="internal_medicine"><div class="department-icon" style="background-image: url('/images/departments/内科.png');"></div> 内科</label>
                                <label><input type="radio" name="department" value="surgery"><div class="department-icon" style="background-image: url('/images/departments/外科.png');"></div> 外科</label>
                                <label><input type="radio" name="department" value="pediatrics"><div class="department-icon" style="background-image: url('/images/departments/小児科.png');"></div> 小児科</label>
                                <label><input type="radio" name="department" value="orthopedics"><div class="department-icon" style="background-image: url('/images/departments/整形外科.png');"></div> 整形外科</label>
                                <label><input type="radio" name="department" value="otorhinolaryngology"><div class="department-icon" style="background-image: url('/images/departments/耳鼻咽喉科.png');"></div> 耳鼻咽喉科</label>
                                <label><input type="radio" name="department" value="dermatology"><div class="department-icon" style="background-image: url('/images/departments/皮膚科.png');"></div> 皮膚科</label>
                                <label><input type="radio" name="department" value="gynecology"><div class="department-icon" style="background-image: url('/images/departments/婦人科.png');"></div> 婦人科</label>
                                <label><input type="radio" name="department" value="urology"><div class="department-icon" style="background-image: url('/images/departments/泌尿器科.png');"></div> 泌尿器科</label>
                                <label><input type="radio" name="department" value="cardiology"><div class="department-icon" style="background-image: url('/images/departments/循環器内科.png');"></div> 循環器内科</label>
                                <label><input type="radio" name="department" value="gastroenterology"><div class="department-icon" style="background-image: url('/images/departments/消化器内科.png');"></div> 消化器内科</label>
                                <label><input type="radio" name="department" value="respiratory_medicine"><div class="department-icon" style="background-image: url('/images/departments/呼吸器内科.png');"></div> 呼吸器内科</label>
                                <label><input type="radio" name="department" value="diabetes_medicine"><div class="department-icon" style="background-image: url('/images/departments/糖尿病内科.png');"></div> 糖尿病内科</label>
                                <label><input type="radio" name="department" value="nephrology"><div class="department-icon" style="background-image: url('/images/departments/腎臓内科.png');"></div> 腎臓内科</label>
                                <label><input type="radio" name="department" value="neurology"><div class="department-icon" style="background-image: url('/images/departments/神経内科.png');"></div> 神経内科</label>
                                <label><input type="radio" name="department" value="endocrinology"><div class="department-icon" style="background-image: url('/images/departments/内分泌科.png');"></div> 内分泌科</label>
                                <label><input type="radio" name="department" value="hematology"><div class="department-icon" style="background-image: url('/images/departments/血液内科.png');"></div> 血液内科</label>
                                <label><input type="radio" name="department" value="neurosurgery"><div class="department-icon" style="background-image: url('/images/departments/脳神経外科.png');"></div> 脳神経外科</label>
                                <label><input type="radio" name="department" value="plastic_surgery"><div class="department-icon" style="background-image: url('/images/departments/形成外科.png');"></div> 形成外科</label>
                                <label><input type="radio" name="department" value="beauty_surgery"><div class="department-icon" style="background-image: url('/images/departments/美容外科.png');"></div> 美容外科</label>
                                <label><input type="radio" name="department" value="psychiatry"><div class="department-icon" style="background-image: url('/images/departments/精神科.png');"></div> 精神科</label>
                                <label><input type="radio" name="department" value="pediatric_dentistry"><div class="department-icon" style="background-image: url('/images/departments/小児歯科.png');"></div> 小児歯科</label>
                                <label><input type="radio" name="department" value="general_dentistry"><div class="department-icon" style="background-image: url('/images/departments/一般歯科.png');"></div> 一般歯科</label>
                                <label><input type="radio" name="department" value="orthodontics"><div class="department-icon" style="background-image: url('/images/departments/矯正歯科.png');"></div> 矯正歯科</label>
                                <label><input type="radio" name="department" value="cosmetic_dentistry"><div class="department-icon" style="background-image: url('/images/departments/審美歯科.png');"></div> 審美歯科</label>
                                <label><input type="radio" name="department" value="oral_surgery"><div class="department-icon" style="background-image: url('/images/departments/口腔外科.png');"></div> 口腔外科</label>
                                <label><input type="radio" name="department" value="anesthesiology"><div class="department-icon" style="background-image: url('/images/departments/麻酔科.png');"></div> 麻酔科</label>
                                <label><input type="radio" name="department" value="radiology"><div class="department-icon" style="background-image: url('/images/departments/放射線科.png');"></div> 放射線科</label>
                                <label><input type="radio" name="department" value="rehabilitation"><div class="department-icon" style="background-image: url('/images/departments/リハビリテーション科.png');"></div> リハビリテーション科</label>
                                <label><input type="radio" name="department" value="allergy"><div class="department-icon" style="background-image: url('/images/departments/アレルギー科.png');"></div> アレルギー科</label>
                            </div>
                        </div>
                    </div>

                    <div class="step-nav-buttons">
                        <button type="button" class="next-step-btn">次の質問へ進む &gt;</button>
                    </div>
                </div>

                <!-- Step 2: 追加情報入力（任意） -->
                <div class="form-step" data-step="2">
                    <div class="step-header">
                        <span class="icon"><img src="/images/icons/hawk.webp" alt="hawk" style="width:100%;height:100%;object-fit:cover;border-radius:50%;"></span>
                        <div>
                            <div class="progress-bar">
                                <span>2/3問目</span>
                                <div class="progress" style="width: 66%;"></div>
                            </div>
                            <h4 class="question-text">あなたのクリニックの特徴を教えてください（任意）。</h4>
                        </div>
                    </div>

                    <div class="additional-info-form">
                        <div class="form-group">
                            <label for="clinic-features">クリニックの強み・特徴</label>
                            <textarea id="clinic-features" name="clinicFeatures" rows="4"
                                placeholder="例：土日診療、最新のCT導入、専門医3名在籍、駐車場完備など"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="target-patients">主なターゲット層</label>
                            <textarea id="target-patients" name="targetPatients" rows="3"
                                placeholder="例：働く世代、高齢者、小児、スポーツをする方など"></textarea>
                        </div>
                    </div>

                    <div class="step-nav-buttons">
                        <button type="button" class="prev-step-btn">&lt; 前へ</button>
                        <button type="button" class="next-step-btn">次の質問へ進む &gt;</button>
                    </div>
                </div>

                <!-- Step 3: 分析範囲選択 -->
                <div class="form-step" data-step="3">
                    <div class="step-header">
                        <span class="icon"><img src="/images/icons/hawk.webp" alt="hawk" style="width:100%;height:100%;object-fit:cover;border-radius:50%;"></span>
                        <div>
                            <div class="progress-bar">
                                <span>3/3問目</span>
                                <div class="progress" style="width: 100%;"></div>
                            </div>
                            <h4 class="question-text">競合分析の範囲を選択してください。</h4>
                        </div>
                    </div>

                    <div class="analysis-range-options">
                        <label class="range-option">
                            <input type="radio" name="analysisRange" value="1000" checked>
                            <div class="range-card">
                                <div class="range-icon">🎯</div>
                                <div class="range-title">1km圏内</div>
                                <div class="range-desc">徒歩圏内の直接競合</div>
                            </div>
                        </label>
                        <label class="range-option">
                            <input type="radio" name="analysisRange" value="3000">
                            <div class="range-card">
                                <div class="range-icon">🚗</div>
                                <div class="range-title">3km圏内</div>
                                <div class="range-desc">車・自転車圏内</div>
                            </div>
                        </label>
                        <label class="range-option">
                            <input type="radio" name="analysisRange" value="5000">
                            <div class="range-card">
                                <div class="range-icon">🚊</div>
                                <div class="range-title">5km圏内</div>
                                <div class="range-desc">広域商圏分析</div>
                            </div>
                        </label>
                    </div>

                    <div class="step-nav-buttons">
                        <button type="button" class="prev-step-btn">&lt; 前へ</button>
                        <button type="button" class="analyze-btn">分析を開始する</button>
                    </div>
                </div>
            </form>

            <!-- 分析中画面 -->
            <div id="analyzing-screen" style="display: none;">
                <div class="loading-container" style="text-align: center; padding: 40px 20px;">
                    <div class="loading-icon" style="margin-bottom: 20px;">
                        <img src="/images/icons/hawk.webp" alt="分析中" style="width: 80px; height: 80px; animation: pulse 2s ease-in-out infinite;">
                    </div>
                    <h2 style="font-size: 1.5em; margin-bottom: 20px; color: #333;">競合分析を実行中...</h2>
                    
                    <div class="loading-progress-container" style="max-width: 400px; margin: 0 auto 20px;">
                        <div class="progress-bar-bg" style="background-color: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div class="progress-bar-fill" style="background-color: #2563eb; height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                        <div class="progress-percentage" style="text-align: center; margin-top: 8px; font-size: 0.9em; color: #666;">0%</div>
                    </div>
                    
                    <div class="loading-step-info" style="text-align: center; color: #666; font-size: 0.9em;">
                        <div class="current-step" style="margin-bottom: 5px;">ステップ 1/3: 近隣の医療機関を検索中</div>
                        <div class="estimated-time" style="color: #999;">予想時間: 約20-30秒</div>
                    </div>
                </div>
            </div>

            <!-- 結果表示画面 -->
            <div id="result-screen" style="display: none;">
                <!-- 結果は動的に生成されます -->
            </div>
        </main>
    </div>

    <script src="/static/admin/competitive/script.js"></script>
</body>
</html>