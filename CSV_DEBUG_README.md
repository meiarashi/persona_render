# CSV Upload Debug Improvements

## 追加したデバッグ機能

### 1. エンコーディング検出機能
- UTF-8 BOM、UTF-16 LE/BE BOMの自動検出
- Shift-JISの自動検出と読み込み（Excel CSV対応）
- エンコーディング情報のコンソール出力

### 2. 詳細なデバッグログ
- ファイルの基本情報（名前、サイズ、タイプ、更新日時）
- 文字コードポイントの表示
- 改行コードの種類検出（Windows/Unix/Mac）
- CSVパース前後のデータ構造表示
- フォーム要素の存在確認
- 最終的なフォーム値の確認

### 3. 診療科マッチング改善
- 完全一致が見つからない場合の部分一致サポート
- 利用可能な診療科リストの表示
- マッチング結果の詳細ログ

### 4. エラーハンドリング改善
- より詳細なエラーメッセージ表示
- エラー時の確認ポイントリスト表示
- コンソールへの完全なスタックトレース出力

### 5. テスト機能（ローカルのみ）
- localhost環境でのデバッグボタン追加
- サンプルCSVの自動テスト機能

## CSV形式の要件

### 必須ヘッダー（順不同）
- クリニック名
- 郵便番号
- 住所
- 診療科
- クリニックの強み・特徴
- 主なターゲット層

### サンプルCSV
```csv
クリニック名,郵便番号,住所,診療科,クリニックの強み・特徴,主なターゲット層
田中内科クリニック,107-0052,東京都港区赤坂4-9-11,内科,土日診療対応・最新機器導入・専門医3名在籍,働く世代・ファミリー層
```

## トラブルシューティング

### CSVが読み込めない場合の確認事項

1. **文字コード**
   - Excel: ファイル → 名前を付けて保存 → ファイルの種類「CSV UTF-8 (コンマ区切り)」を選択
   - メモ帳: ファイル → 名前を付けて保存 → 文字コード「UTF-8」を選択

2. **ヘッダー名**
   - ヘッダー名が正確に一致しているか確認
   - 余分なスペースが入っていないか確認

3. **診療科名**
   - 設定されている診療科名と一致しているか確認
   - 部分一致でも動作するが、正確な名前が推奨

4. **デバッグ方法**
   - ブラウザの開発者ツール（F12）でコンソールを開く
   - CSVアップロード時のログを確認
   - エラーメッセージの詳細を確認

## テスト用HTMLページ

`test_csv_parsing.html`を使用して、CSV解析機能を独立してテストできます：
1. ブラウザで`test_csv_parsing.html`を開く
2. 各テストボタンでCSV解析をテスト
3. 実際のCSVファイルをアップロードしてテスト